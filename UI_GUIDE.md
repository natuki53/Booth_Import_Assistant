# Unity UI ガイド

BOOTH Import Assistant の Unity Editor 拡張UIの詳細ガイドです。

---

## 📊 メインウィンドウ

`Tools > BOOTH Library` で開くメインウィンドウです。

### ヘッダー部分

```
┌────────────────────────────────────────┐
│ BOOTH Import Assistant                 │
│                                        │
│ [同期]  [再読み込み]      ● Bridge起動中 │
│ ──────────────────────────────────────│
└────────────────────────────────────────┘
```

- **同期**: BOOTHから全ページを取得
- **再読み込み**: JSONを再読み込み
- **Bridge起動中**: 緑=起動中、灰=停止中

---

## 🎨 商品カードUI

### パターン1: 単一ダウンロード

```
┌─────────────────────────────────────────────┐
│ [サムネ]  もふもふメイド衣装                │
│  64x64    作者: もふまじっく                │
│           購入日: 2025-10-27               │
│                                             │
│                          [📥 ダウンロード]  │
│                          [🌐 商品ページ]    │
└─────────────────────────────────────────────┘
```

**特徴:**
- シンプルなダウンロードボタン1つ
- クリックで直接ダウンロードページへ

---

### パターン2: 2〜3個のバリエーション

```
┌─────────────────────────────────────────────┐
│ [サムネ]  メイド衣装セット                  │
│  64x64    作者: もふまじっく                │
│           購入日: 2025-10-27               │
│                                             │
│                     📥 ダウンロード:         │
│                     [萌ちゃん用]            │
│                     [桔梗ちゃん用]          │
│                     [マテリアル共通]        │
│                     [🌐 商品ページ]         │
└─────────────────────────────────────────────┘
```

**特徴:**
- 各バリエーション用のボタンが縦に並ぶ
- 3個以下なら全て表示
- ボタンが見やすく、選択しやすい

---

### パターン3: 4個以上のバリエーション（ドロップダウン）

```
┌─────────────────────────────────────────────┐
│ [サムネ]  衣装10種セット                    │
│  64x64    作者: もふまじっく                │
│           購入日: 2025-10-27               │
│                                             │
│              📥 バリエーション選択:          │
│              [萌ちゃん用        ▼]          │
│              [選択中をDL]                   │
│              [全てDL]                       │
│              [🌐 商品ページ]                │
└─────────────────────────────────────────────┘
```

**特徴:**
- **ドロップダウンメニュー**で選択
- 縦スペースを節約
- 選択状態を記憶
- 「全てDL」で一括ダウンロード可能

**ドロップダウンの選択肢例:**
```
┌────────────────────┐
│ 萌ちゃん用          │  ← 選択中
│ 桔梗ちゃん用        │
│ 舞夜ちゃん用        │
│ セレスティア用      │
│ リリス用           │
│ マテリアル共通      │
│ メッシュのみ        │
│ テクスチャのみ      │
└────────────────────┘
```

---

## 🔄 UI切り替えの仕組み

### 自動判定

```csharp
if (asset.downloadUrls.Length == 1) {
    // パターン1: 単一ダウンロードボタン
    GUILayout.Button("📥 ダウンロード");
}
else if (asset.downloadUrls.Length <= 3) {
    // パターン2: コンパクトボタン表示
    foreach (var url in downloadUrls) {
        GUILayout.Button(url.label);
    }
}
else {
    // パターン3: ドロップダウン + ボタン
    EditorGUILayout.Popup(selectedIndex, options);
    GUILayout.Button("選択中をDL");
    GUILayout.Button("全てDL");
}
```

---

## 🎯 各ボタンの機能

### 📥 ダウンロード / 選択中をDL

**動作:**
1. 選択したバリエーションのダウンロードページをブラウザで開く
2. ダイアログで保存すべきファイル名を表示

**表示例:**
```
┌──────────────────────────────────────┐
│ ダウンロード                          │
│                                      │
│ ダウンロードページが開きました。      │
│                                      │
│ 対象: 萌ちゃん用                      │
│                                      │
│ BOOTHから「booth_1234567_1.zip」と   │
│ いう名前でダウンロードしてください。   │
│                                      │
│ ダウンロードフォルダに保存すると、    │
│ 自動的にUnityに展開されます。         │
│                                      │
│                     [OK]             │
└──────────────────────────────────────┘
```

---

### 全てDL

**動作:**
1. 確認ダイアログを表示
2. すべてのバリエーションのダウンロードページを順次開く（0.5秒間隔）
3. 各ファイルの保存名を案内

**確認ダイアログ:**
```
┌──────────────────────────────────────┐
│ 確認                                  │
│                                      │
│ 6個のファイルをすべてダウンロード    │
│ しますか？                            │
│                                      │
│            [はい]  [キャンセル]      │
└──────────────────────────────────────┘
```

**案内ダイアログ:**
```
┌──────────────────────────────────────┐
│ 全バリエーションダウンロード          │
│                                      │
│ 6個のダウンロードページを開きました。│
│                                      │
│ 各ページから以下の名前でダウンロード  │
│ してください：                        │
│                                      │
│ [1] 萌ちゃん用                       │
│     → booth_1234567_1.zip           │
│                                      │
│ [2] 桔梗ちゃん用                     │
│     → booth_1234567_2.zip           │
│ ...                                  │
│                                      │
│ ダウンロードフォルダに保存すると、    │
│ 自動的にUnityに展開されます。         │
│                                      │
│                     [OK]             │
└──────────────────────────────────────┘
```

---

### 🌐 商品ページ

BOOTHの商品ページを外部ブラウザで開きます。

---

## 💾 選択状態の保持

ドロップダウンの選択状態は、**セッション中保持**されます。

```csharp
// Dictionary で各商品の選択状態を記憶
private Dictionary<string, int> selectedDownloadIndex;

// 商品ID をキーに選択インデックスを保存
selectedDownloadIndex[asset.id] = 2; // 3番目を選択中
```

**メリット:**
- 同じ商品を何度も選択する手間を省く
- 複数の商品を行き来しても選択が維持される

---

## 🎨 UI要素の詳細

### アイコンの意味

| アイコン | 意味 |
|---------|------|
| 📥 | ダウンロード |
| 🌐 | 商品ページ |
| 📄 | 商品ページで確認（DLリンクなし） |
| ✅ | インポート済み |
| 🔄 | 同期中 |
| ● | Bridgeステータス |

### ボタンサイズ

| ボタン | 高さ |
|--------|------|
| メインダウンロード | 28px |
| バリエーション選択 | 24px |
| 全てDL | 22px |
| 商品ページ | 25px |

---

## 🔍 実際の使用例

### ケース1: 単一ダウンロード（シンプル）

```
商品: 「シンプルTシャツ」
バリエーション: 1種類

操作:
1. [📥 ダウンロード] ボタンをクリック
2. BOOTHページが開く
3. booth_123456.zip で保存
4. 自動展開
```

---

### ケース2: 3種類のバリエーション

```
商品: 「メイド衣装3色セット」
バリエーション:
- 赤色
- 青色
- 緑色

操作:
1. [赤色] ボタンをクリック → booth_123456_1.zip
2. [青色] ボタンをクリック → booth_123456_2.zip
3. [緑色] ボタンをクリック → booth_123456_3.zip
```

---

### ケース3: 10種類のアバター対応（ドロップダウン）

```
商品: 「汎用衣装10種対応」
バリエーション:
- 萌ちゃん用
- 桔梗ちゃん用
- 舞夜ちゃん用
- セレスティア用
- リリス用
- 竜胆ちゃん用
- マヌカ用
- 森羅用
- アバター9
- マテリアル共通

操作パターンA（個別ダウンロード）:
1. ドロップダウンで「萌ちゃん用」を選択
2. [選択中をDL] をクリック
3. booth_123456_1.zip で保存

操作パターンB（全部まとめてダウンロード）:
1. [全てDL] をクリック
2. 確認ダイアログで [はい]
3. 10個のタブが開く（0.5秒間隔）
4. 各タブから順番にダウンロード
   - booth_123456_1.zip
   - booth_123456_2.zip
   ...
   - booth_123456_10.zip
```

---

## 📊 レイアウト調整

### ボタンエリアの幅

```csharp
// バリエーションが多い場合は幅を広く
EditorGUILayout.BeginVertical(GUILayout.Width(180)); // 150 → 180
```

### ラベルの省略

```csharp
// 18文字を超える場合は省略
if (label.Length > 18) {
    label = label.Substring(0, 15) + "...";
}
```

**例:**
- `萌ちゃん用` → そのまま
- `カスタムアバター用（特別版）` → `カスタムアバタ...`

---

## 🐛 トラブルシューティング

### ドロップダウンが選択できない

**原因**: 選択状態が初期化されていない

**対処**: 自動的に0（最初の項目）が選択されます

```csharp
if (!selectedDownloadIndex.ContainsKey(asset.id)) {
    selectedDownloadIndex[asset.id] = 0; // 自動初期化
}
```

---

### 全てDLボタンを押してもページが開かない

**原因**: Bridge が起動していない

**対処**: 自動的にBridge起動を試みます

---

### ボタンが押せない・反応しない

**原因**: Unity Editor がフリーズしている可能性

**対処**:
1. Unity を再起動
2. Bridge を手動で再起動

---

## 🎯 今後の改善予定

- [ ] インポート済みバリエーションの表示
- [ ] ダウンロード済みの表示（チェックマーク）
- [ ] お気に入り機能
- [ ] カスタムタグ
- [ ] フィルタ・検索機能

---

この UI デザインにより、1商品に10種類以上のバリエーションがあっても、快適に管理できます！🎨✨

